#!/usr/bin/env python3
# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.

name: kfam
summary: Kubeflow Access Management API
description: Kubeflow Access Management API provides fine-grain user-namespace level access control.
version: "v1.7.0"
license: Apache-2.0
base: ubuntu:22.04
platforms:
  amd64:
services:
  access-manager:
    override: replace
    command: "/manager -userid-header kubeflow-userid -userid-prefix ''"
    startup: enabled
    user: kfam
parts:
  kfam:
    plugin: dump
    build-snaps: [go]
    source: https://github.com/kubeflow/kubeflow
    source-subdir: components/access-management
    source-tag: "v1.7.0"
    build-environment:
      - CGO_ENABLED: 0
      - GOOS: linux
    override-build: |
        go build -gcflags 'all=-N -l' -o access-management main.go
        cp access-management $CRAFT_PART_INSTALL/access-management
        cp third_party $CRAFT_PART_INSTALL/third_party
        cp /go/pkg/mod/github.com/hashicorp $CRAFT_PART_INSTALL/third_party/library/
